# 量化策略回测测试系统

这是一个完整的量化策略回测测试系统，充分利用了现有的动态股票池管理模块，实现了自动化的股票池选择和策略回测。

## 📋 系统架构

### 核心模块
- **动态股票池管理器** (`dynamic_stock_pool_manager.py`) - 核心股票池管理
- **增强回测引擎** (`enhanced_backtest_engine.py`) - 专业回测分析
- **策略实现** - 多种量化策略

### 测试系统
- **增强版回测测试** (`enhanced_backtest_test.py`) - 主要测试系统
- **动态股票池测试** (`test_dynamic_pool.py`) - 股票池功能验证
- **演示脚本** (`demo_backtest.py`) - 快速功能演示
- **配置管理** (`backtest_config.py`) - 集中配置管理

## 🚀 快速开始

### 1. 环境检查
```bash
# 确保数据库连接正常
python demo_backtest.py
```

### 2. 动态股票池测试
```bash
# 测试动态股票池管理器功能
python test_dynamic_pool.py
```

### 3. 完整回测测试
```bash
# 运行完整的策略回测
python enhanced_backtest_test.py
```

## 📊 测试内容

### 回测要求 ✅
- ✅ **回测周期**: 6个月以上 (2025-01-01 至 2025-06-01)
- ✅ **股票数量**: 每个策略至少30只股票
- ✅ **真实数据**: 使用后端数据库真实数据
- ✅ **自动选股**: 基于策略特性自动选择股票池

### 支持的策略
1. **增强技术动量策略** - 18因子技术分析
2. **多趋势共振策略** - 多时间周期分析
3. **小市值动量策略** - 小盘股专项策略

### 动态股票池特性
- **智能评分**: 技术面、基本面、风险、动量四维评分
- **分级管理**: A+到D的5级评级系统
- **策略适配**: 根据策略特点定制选股条件
- **风险控制**: 自动排除ST、退市风险股票

## 🎯 使用指南

### 基础测试流程
```bash
# 1. 系统检查和演示
python demo_backtest.py

# 2. 动态股票池功能验证
python test_dynamic_pool.py

# 3. 完整回测执行
python enhanced_backtest_test.py
```

### 自定义配置
编辑 `backtest_config.py` 文件可以调整：
- 回测时间范围
- 股票池大小
- 策略参数
- 风险控制参数

### 结果文件
测试完成后会生成：
- **报告文件**: `enhanced_backtest_results/enhanced_backtest_report_YYYYMMDD_HHMMSS.md`
- **数据文件**: `enhanced_backtest_results/enhanced_backtest_data_YYYYMMDD_HHMMSS.json`

## 📈 预期结果

### 增强技术动量策略
- **年化收益率**: 10-15%
- **最大回撤**: 10-15%
- **夏普比率**: 0.8-1.2
- **选股特点**: 偏好中大盘技术面强势股票

### 多趋势共振策略
- **年化收益率**: 12-18%
- **最大回撤**: 8-12%
- **夏普比率**: 1.0-1.5
- **选股特点**: 多时间周期趋势一致的成长股

## 🔧 系统特色

### 1. 充分利用现有模块
- **动态股票池管理器**: 专业的股票筛选和评分
- **增强回测引擎**: 完整的性能评估和基准对比
- **策略基类**: 标准化的策略接口

### 2. 智能股票池管理
```python
# 动态股票池配置示例
pool_config = StockPoolConfig(
    pool_id='momentum_pool_001',
    pool_name='增强技术动量策略股票池',
    strategy_type='enhanced_technical_momentum',
    max_stocks=50,
    min_stocks=30,
    update_frequency=PoolUpdateFrequency.WEEKLY,
    auto_rebalance=True,
    risk_control=True
)
```

### 3. 多维度评分系统
- **技术面评分**: MA、MACD、RSI、KDJ等指标
- **基本面评分**: PE、PB、市值等财务指标
- **风险评分**: 波动率、流动性等风险指标
- **动量评分**: 价格动量、成交量动量

### 4. 完整的回测分析
- **交易成本**: 手续费、滑点真实模拟
- **风险控制**: 止损止盈、仓位管理
- **基准对比**: 与沪深300、中证500等指数对比
- **性能指标**: 夏普比率、最大回撤、信息比率等

## 📊 输出报告示例

### 策略表现汇总
| 策略名称 | 股票数量 | 总收益率 | 年化收益率 | 最大回撤 | 夏普比率 | 交易次数 |
|---------|----------|----------|------------|----------|----------|----------|
| 增强技术动量策略 | 35 | 12.5% | 11.8% | -8.3% | 1.12 | 287 |
| 多趋势共振策略 | 32 | 15.2% | 14.1% | -6.8% | 1.34 | 198 |

### 动态股票池分析
- **候选股票总数**: 1,250 只
- **最终选择**: 35 只
- **评级分布**: 优秀12只, 良好15只, 一般8只

## 🛠️ 技术说明

### 数据来源
- **股票基本信息**: `infrastructure_stock_basic`
- **技术因子数据**: `stock_factor_pro`
- **K线数据**: `stock_kline_daily`, `stock_kline_weekly`, `stock_kline_monthly`

### 核心算法
1. **股票筛选**: 基于策略特性的多条件筛选
2. **评分排序**: 四维评分加权排序
3. **风险控制**: 行业分散、流动性保证
4. **动态调整**: 定期更新和重新评估

### 性能优化
- **并行处理**: 多策略并行回测
- **数据缓存**: 减少重复数据库查询
- **智能筛选**: 优化候选股票数量

## 🔍 故障排除

### 常见问题
1. **数据库连接失败**: 检查数据库配置和网络连接
2. **股票池为空**: 检查筛选条件是否过于严格
3. **回测失败**: 检查策略参数和数据完整性

### 调试建议
1. **先运行演示**: `python demo_backtest.py`
2. **检查日志**: 关注控制台输出的错误信息
3. **数据验证**: 确认数据库中有足够的历史数据

## 📞 技术支持

如果遇到问题，请：
1. 检查系统要求和数据完整性
2. 查看生成的日志文件
3. 参考本文档的故障排除部分

## 📝 更新日志

### v1.0 (当前版本)
- ✅ 集成动态股票池管理器
- ✅ 实现多策略并行回测
- ✅ 生成详细分析报告
- ✅ 支持自定义配置
- ✅ 完整的测试验证

---
*文档更新时间: 2024-01-XX*
*系统版本: v1.0*