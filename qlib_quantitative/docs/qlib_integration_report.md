# Qlibæ¡†æ¶é›†æˆæŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æˆåŠŸå°†åŸæœ‰çš„abupyé‡åŒ–äº¤æ˜“ç³»ç»Ÿè¿ç§»åˆ°Microsoft Qlibæ¡†æ¶ï¼Œå®ç°äº†å®Œæ•´çš„é‡åŒ–äº¤æ˜“ç­–ç•¥å¼€å‘å’Œå›æµ‹ç³»ç»Ÿã€‚

## é›†æˆå®Œæˆæƒ…å†µ

### âœ… å·²å®Œæˆçš„æ ¸å¿ƒæ¨¡å—

#### 1. æ•°æ®é€‚é…å™¨ (QlibDataAdapter)
- **æ–‡ä»¶ä½ç½®**: `core/data_adapter.py`
- **åŠŸèƒ½**: 
  - è¿æ¥MongoDBæ•°æ®åº“ä¸Qlibæ¡†æ¶
  - ç»§æ‰¿è‡ªqlib.data.BaseProvider
  - æ”¯æŒè‚¡ç¥¨æ•°æ®ã€å› å­æ•°æ®å’ŒåŸºå‡†æ•°æ®è·å–
  - å®ç°è‚¡ç¥¨ä»£ç æ ¼å¼è½¬æ¢ (æ•°æ®åº“æ ¼å¼ â†” Qlibæ ¼å¼)
  - æ”¯æŒå¤šè‚¡ç¥¨æ•°æ®æ‰¹é‡å¤„ç†
- **æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡

#### 2. æŠ•èµ„ç»„åˆç®¡ç†å™¨ (QlibPortfolioManager)
- **æ–‡ä»¶ä½ç½®**: `core/portfolio_manager_qlib.py`
- **åŠŸèƒ½**:
  - èµ„é‡‘åˆ†é…å’Œä»“ä½ç®¡ç†
  - é£é™©æ§åˆ¶å’Œæ­¢æŸæ­¢ç›ˆ
  - æŠ•èµ„ç»„åˆæ€§èƒ½åˆ†æ
  - æ”¯æŒTopK Dropoutç­–ç•¥
- **æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡

#### 3. å¥½å¥‡å¸ƒå¶çŒ«BOLLç­–ç•¥ (CuriousRagdollBollModel)
- **æ–‡ä»¶ä½ç½®**: `strategies/curious_ragdoll_boll_qlib.py`
- **åŠŸèƒ½**:
  - ç»§æ‰¿è‡ªqlib.model.base.Model
  - åŸºäºå¸ƒæ—å¸¦çš„æŠ€æœ¯æŒ‡æ ‡ç­–ç•¥
  - æ”¯æŒè¶‹åŠ¿å› å­å’ŒåŠ¨é‡å› å­
  - å®Œæ•´çš„ä¿¡å·ç”Ÿæˆå’Œå›æµ‹é€»è¾‘
- **æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡

### ğŸ”§ æ ¸å¿ƒæŠ€æœ¯å®ç°

#### 1. Qlibæ¡†æ¶åŸºç¡€è®¾æ–½
```python
# æ¨¡å‹åŸºç±»ç»§æ‰¿
class CuriousRagdollBollModel(Model):
    def fit(self, dataset):
        # è®­ç»ƒé€»è¾‘
        return self
    
    def predict(self, dataset) -> pd.Series:
        # é¢„æµ‹é€»è¾‘
        return signals

# ç­–ç•¥åŸºç±»ç»§æ‰¿
class CuriousRagdollBollStrategy(BaseStrategy):
    def generate_trade_decision(self, execute_result=None):
        # äº¤æ˜“å†³ç­–é€»è¾‘
        return trade_decisions
```

#### 2. æ•°æ®æ¥å£é€‚é…
```python
class QlibDataAdapter(BaseProvider):
    def get_stock_data(self, symbol, start_date, end_date, fields):
        # MongoDBæ•°æ®è·å–
        return qlib_format_data
    
    def get_multi_stock_data(self, symbols, start_date, end_date, fields):
        # å¤šè‚¡ç¥¨æ•°æ®å¤„ç†
        return multi_index_dataframe
```

#### 3. æŠ•èµ„ç»„åˆç®¡ç†
```python
class QlibPortfolioManager:
    def calculate_position_size(self, symbol, price, signal_strength):
        # ä»“ä½è®¡ç®—é€»è¾‘
        return shares
    
    def generate_trade_decision(self, predictions, current_positions):
        # äº¤æ˜“å†³ç­–ç”Ÿæˆ
        return trade_decisions
```

### ğŸ“Š æµ‹è¯•ç»“æœ

#### æ ¸å¿ƒæ¨¡å—æµ‹è¯•ç»“æœ
```
æ•°æ®é€‚é…å™¨: âœ“ é€šè¿‡
BOLLç­–ç•¥: âœ“ é€šè¿‡  
æŠ•èµ„ç»„åˆç®¡ç†å™¨: âœ“ é€šè¿‡
æ€»è®¡: 3/3 æ¨¡å—æµ‹è¯•é€šè¿‡
```

#### åŠŸèƒ½éªŒè¯
- âœ… æ•°æ®æ ¼å¼è½¬æ¢: `000001` â†’ `SZ000001` â†’ `000001`
- âœ… ç­–ç•¥é…ç½®: å¸ƒæ—å¸¦å‘¨æœŸ20, æ ‡å‡†å·®2.0
- âœ… æ¨¡å‹åˆ›å»º: æˆåŠŸåˆ›å»ºCuriousRagdollBollModel
- âœ… æŠ•èµ„ç»„åˆç®¡ç†: åˆå§‹èµ„é‡‘1,000,000ï¼Œä»“ä½è®¡ç®—æ­£å¸¸
- âœ… æ•°æ®åº“è¿æ¥: æœ¬åœ°MongoDB + äº‘ç«¯MongoDBåŒè¿æ¥

### ğŸ—ï¸ æ¶æ„è®¾è®¡

#### 1. æ¨¡å—ç»“æ„
```
abu_quantitative/
â”œâ”€â”€ __init__.py                    # Qlibæ¡†æ¶ä¸»å…¥å£
â”œâ”€â”€ core/                          # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ data_adapter.py           # æ•°æ®é€‚é…å™¨
â”‚   â”œâ”€â”€ portfolio_manager_qlib.py # æŠ•èµ„ç»„åˆç®¡ç†å™¨
â”‚   â”œâ”€â”€ strategy_base_qlib.py     # ç­–ç•¥åŸºç±»
â”‚   â””â”€â”€ backtest_engine_qlib.py   # å›æµ‹å¼•æ“
â”œâ”€â”€ strategies/                    # ç­–ç•¥æ¨¡å—
â”‚   â””â”€â”€ curious_ragdoll_boll_qlib.py # BOLLç­–ç•¥
â””â”€â”€ test_qlib_simple.py           # æµ‹è¯•è„šæœ¬
```

#### 2. ä¾èµ–å…³ç³»
```
MongoDBæ•°æ®åº“ â†’ QlibDataAdapter â†’ Qlibæ¡†æ¶ â†’ ç­–ç•¥æ¨¡å‹ â†’ æŠ•èµ„ç»„åˆç®¡ç† â†’ å›æµ‹ç»“æœ
```

### ğŸ”„ è¿ç§»å¯¹æ¯”

#### åŸabupyæ¡†æ¶
- åŸºäºPython 2.7/3.6
- ä¾èµ–abupyåº“
- è‡ªå®šä¹‰æ•°æ®å¤„ç†
- ç®€å•å›æµ‹æ¡†æ¶

#### æ–°Qlibæ¡†æ¶
- åŸºäºPython 3.8+
- ä½¿ç”¨Microsoft Qlib
- æ ‡å‡†åŒ–æ•°æ®æ¥å£
- ä¸“ä¸šé‡åŒ–å›æµ‹æ¡†æ¶
- æ›´å¥½çš„æ€§èƒ½å’Œæ‰©å±•æ€§

### ğŸ“ˆ ç­–ç•¥ç‰¹ç‚¹

#### å¥½å¥‡å¸ƒå¶çŒ«BOLLç­–ç•¥
- **ç­–ç•¥ç±»å‹**: æŠ€æœ¯æŒ‡æ ‡æ‹©æ—¶ç­–ç•¥
- **æ ¸å¿ƒæŒ‡æ ‡**: å¸ƒæ—å¸¦ (20æ—¥å‘¨æœŸ, 2å€æ ‡å‡†å·®)
- **é€‰è‚¡é€»è¾‘**: ä¸­è¯500æˆåˆ†è‚¡ä¸­é€‰æ‹©å°å¸‚å€¼å‰50åª
- **ä¹°å…¥æ¡ä»¶**: 
  1. å‰ä¸€äº¤æ˜“æ—¥æ”¶ç›˜ä»· < å¸ƒæ—ä¸‹è½¨
  2. å½“å‰æ”¶ç›˜ä»· > å‰ä¸€äº¤æ˜“æ—¥æ”¶ç›˜ä»· (åå¼¹)
  3. å½“å‰æ”¶ç›˜ä»· > å‰æœŸä½ç‚¹ (çªç ´)
- **å–å‡ºæ¡ä»¶**:
  1. æ­¢æŸ: å½“å‰ä»·æ ¼ < å‰æœŸä½ç‚¹
  2. æ­¢ç›ˆ: è§¦åŠå¸ƒæ—ä¸Šè½¨åå›è½
- **é£æ§å‚æ•°**: 
  - æ­¢æŸæ¯”ä¾‹: 8%
  - æ­¢ç›ˆæ¯”ä¾‹: 15%
  - æœ€å¤§æŒä»“: 10åªè‚¡ç¥¨

### ğŸ¯ æ€§èƒ½ä¼˜åŒ–

#### 1. æ•°æ®å¤„ç†ä¼˜åŒ–
- ä½¿ç”¨MongoDBä½œä¸ºæ•°æ®æºï¼Œé¿å…qlibæ•°æ®ç¼“å­˜é…ç½®é—®é¢˜
- å®ç°æ‰¹é‡æ•°æ®å¤„ç†ï¼Œæé«˜æ•°æ®è·å–æ•ˆç‡
- ä¼˜åŒ–è‚¡ç¥¨ä»£ç æ ¼å¼è½¬æ¢é€»è¾‘

#### 2. å†…å­˜ç®¡ç†
- ç§»é™¤ä¸å¿…è¦çš„æ•°æ®ç¼“å­˜æœºåˆ¶
- ä¼˜åŒ–DataFrameæ“ä½œï¼Œå‡å°‘å†…å­˜å ç”¨
- å®ç°å¢é‡æ•°æ®å¤„ç†

#### 3. è®¡ç®—æ•ˆç‡
- ä½¿ç”¨å‘é‡åŒ–è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
- ä¼˜åŒ–ä¿¡å·ç”Ÿæˆç®—æ³•
- å¹¶è¡Œå¤„ç†å¤šåªè‚¡ç¥¨æ•°æ®

### ğŸš€ æœªæ¥è§„åˆ’

#### 1. ç­–ç•¥æ‰©å±•
- [ ] æ·»åŠ æ›´å¤šæŠ€æœ¯æŒ‡æ ‡ç­–ç•¥
- [ ] å®ç°æœºå™¨å­¦ä¹ é€‰è‚¡æ¨¡å‹
- [ ] å¼€å‘å¤šå› å­ç­–ç•¥æ¡†æ¶

#### 2. åŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ å®æ—¶æ•°æ®æ¥å£
- [ ] å®ç°ç­–ç•¥å‚æ•°ä¼˜åŒ–
- [ ] å¼€å‘é£é™©æ¨¡å‹

#### 3. æ€§èƒ½æå‡
- [ ] ä½¿ç”¨GPUåŠ é€Ÿè®¡ç®—
- [ ] å®ç°åˆ†å¸ƒå¼å›æµ‹
- [ ] ä¼˜åŒ–æ•°æ®å­˜å‚¨ç»“æ„

### ğŸ“ ç»“è®º

é€šè¿‡æœ¬æ¬¡è¿ç§»ï¼Œæˆ‘ä»¬æˆåŠŸå°†é‡åŒ–äº¤æ˜“ç³»ç»Ÿä»abupyæ¡†æ¶è¿ç§»åˆ°Microsoft Qlibæ¡†æ¶ï¼Œå®ç°äº†ï¼š

1. **å®Œæ•´çš„æ¡†æ¶é›†æˆ**: æ‰€æœ‰æ ¸å¿ƒæ¨¡å—éƒ½æˆåŠŸé€‚é…Qlibæ¡†æ¶
2. **åŠŸèƒ½å®Œæ•´æ€§**: ä¿æŒäº†åŸæœ‰ç­–ç•¥çš„å®Œæ•´é€»è¾‘
3. **æ€§èƒ½æå‡**: åˆ©ç”¨Qlibçš„ä¸“ä¸šå›æµ‹æ¡†æ¶æå‡æ€§èƒ½
4. **å¯æ‰©å±•æ€§**: ä¸ºæœªæ¥ç­–ç•¥å¼€å‘æä¾›äº†è‰¯å¥½çš„åŸºç¡€

è¯¥ç³»ç»Ÿç°åœ¨å¯ä»¥æ”¯æŒï¼š
- åŸºäºQlibæ¡†æ¶çš„ä¸“ä¸šé‡åŒ–ç­–ç•¥å¼€å‘
- è¿æ¥MongoDBæ•°æ®åº“è¿›è¡Œæ•°æ®å¤„ç†
- å®Œæ•´çš„æŠ•èµ„ç»„åˆç®¡ç†å’Œé£é™©æ§åˆ¶
- é«˜æ•ˆçš„å›æµ‹å’Œæ€§èƒ½åˆ†æ

**æ¨èä¸‹ä¸€æ­¥**: åŸºäºå½“å‰æ¡†æ¶å¼€å‘æ›´å¤šé‡åŒ–ç­–ç•¥ï¼Œå¹¶è¿›è¡Œå®é™…å¸‚åœºæ•°æ®çš„å›æµ‹éªŒè¯ã€‚

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-07-18 19:50:00*
*ç‰ˆæœ¬: Qlibæ¡†æ¶ç‰ˆæœ¬ 2.0.0*