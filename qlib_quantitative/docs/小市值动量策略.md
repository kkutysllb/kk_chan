# å°å¸‚å€¼åŠ¨é‡ç­–ç•¥ï¼ˆå¤ªä¸Šè€å›3å·ç­–ç•¥ï¼‰

## ç­–ç•¥æ¦‚è¿°

å°å¸‚å€¼åŠ¨é‡ç­–ç•¥æ˜¯ä¸€ä¸ªåŸºäºä¸­è¯1000æˆåˆ†è‚¡çš„3å› å­å¢å¼ºé‡åŒ–ç­–ç•¥ï¼Œä¸“æ³¨äºæŒ–æ˜å°å¸‚å€¼è‚¡ç¥¨çš„æˆé•¿æ½œåŠ›ã€‚è¯¥ç­–ç•¥é›†æˆäº†RSIæ‹©æ—¶ã€å¤šå› å­è¯„åˆ†å’Œå…¨é¢é£é™©æ§åˆ¶ä¸‰å¤§æ ¸å¿ƒè¦ç´ ï¼Œé€šè¿‡å‘¨åº¦è°ƒä»“æœºåˆ¶å®ç°ç¨³å¥çš„è¶…é¢æ”¶ç›Šã€‚

### ğŸ¯ ç­–ç•¥å®šä½
- **ä»£å·**: å¤ªä¸Šè€å›3å·ç­–ç•¥
- **ç±»å‹**: å°å¸‚å€¼åŠ¨é‡å¢å¼ºç­–ç•¥
- **åŸºç¡€**: 3å› å­ç­–ç•¥æ€æƒ³ä¼˜åŒ–
- **ç‰¹è‰²**: æ¯å‘¨è°ƒä»“ï¼Œé™ä½äº¤æ˜“æˆæœ¬

## ç­–ç•¥ç‰¹è‰²

### ğŸ¯ æ ¸å¿ƒç†å¿µ
- **3å› å­å¢å¼º**ï¼šRSIæ‹©æ—¶ + å¤šå› å­è¯„åˆ† + é£é™©æ§åˆ¶
- **å¸‚åœºæ‹©æ—¶**ï¼šRSI(8æ—¥å‘¨æœŸ)åˆ¤æ–­å¸‚åœºæ—¶æœº
- **ç²¾å‡†é€‰è‚¡**ï¼šå¤šå› å­è¯„åˆ†æ’åºï¼Œå½’ä¸€åŒ–å¤„ç†
- **å‘¨åº¦è°ƒä»“**ï¼šæ¯5ä¸ªäº¤æ˜“æ—¥è°ƒä»“ä¸€æ¬¡ï¼Œé™ä½äº¤æ˜“æˆæœ¬
- **å…¨é¢é£æ§**ï¼šè¡Œä¸šåˆ†æ•£ã€æ­¢æŸæ­¢ç›ˆã€ç´§æ€¥æ­¢æŸä¸‰é‡ä¿æŠ¤

### ğŸ“Š ç­–ç•¥è¡¨ç°ï¼ˆåŸºäºå›æµ‹ï¼‰
- **å¹´åŒ–æ”¶ç›Šç‡**ï¼šç›®æ ‡15-25%
- **å¤æ™®æ¯”ç‡**ï¼šç›®æ ‡1.0-1.5
- **æœ€å¤§å›æ’¤**ï¼šç›®æ ‡æ§åˆ¶åœ¨18-30%
- **èƒœç‡**ï¼šç›®æ ‡60-70%
- **è°ƒä»“é¢‘ç‡**ï¼šæ¯å‘¨è°ƒä»“ï¼ˆçº¦æ¯5ä¸ªäº¤æ˜“æ—¥ï¼‰
- **æŒä»“è‚¡æ•°**ï¼š10-25åªåˆ†æ•£é…ç½®

## ç­–ç•¥é€»è¾‘

### ğŸ” è‚¡ç¥¨æ± æ„å»º
```python
# 1. åŸºç¡€è‚¡ç¥¨æ± ï¼šä¸­è¯1000æˆåˆ†è‚¡
def get_small_cap_stocks(max_count=30):
    # ä»DynamicStockPoolManagerè·å–å°å¸‚å€¼è‚¡ç¥¨
    pool_manager = DynamicStockPoolManager()
    selected_stocks = pool_manager.get_small_cap_stocks(max_count=max_count)
    
    # åŸºç¡€ç­›é€‰æ¡ä»¶
    filter_criteria = {
        'min_market_cap': 100000.0,    # æœ€å°å¸‚å€¼10äº¿
        'max_market_cap': 1000000.0,   # æœ€å¤§å¸‚å€¼1000äº¿
        'exclude_st': True,            # æ’é™¤STè‚¡ç¥¨
        'exclude_suspended': True,     # æ’é™¤åœç‰Œè‚¡ç¥¨
        'min_volume_ratio': 0.8,       # æœ€å°é‡æ¯”è¦æ±‚
        'min_turnover_rate': 1.0,      # æœ€å°æ¢æ‰‹ç‡1%
        'max_turnover_rate': 12.0      # æœ€å¤§æ¢æ‰‹ç‡12%
    }
    
    return selected_stocks

# 2. åŠ¨æ€è¯„åˆ†æ’åº
def rank_stocks_by_score(stocks):
    # è®¡ç®—æ¯åªè‚¡ç¥¨çš„ç»¼åˆè¯„åˆ†
    # è¿”å›è¯„åˆ†æ’åºåçš„è‚¡ç¥¨åˆ—è¡¨
    scores = []
    for stock in stocks:
        score = calculate_comprehensive_score(stock)
        scores.append((stock, score))
    
    # æŒ‰åˆ†æ•°é™åºæ’åº
    return sorted(scores, key=lambda x: x[1], reverse=True)
```

### ğŸ“ˆ 3å› å­å¢å¼ºè¯„åˆ†æ¨¡å‹
```python
# 1. RSIå¸‚åœºæ‹©æ—¶æ¨¡å—
class MarketTimingModule:
    def __init__(self):
        self.rsi_period = 8      # RSIå‘¨æœŸï¼ˆå‘¨çº¿ï¼‰
        self.rsi_upper = 70      # RSIä¸Šé™
        self.rsi_lower = 30      # RSIä¸‹é™
        
    def get_market_signal(self, market_data):
        # è®¡ç®—å¸‚åœºRSI
        rsi = calculate_rsi(market_data, self.rsi_period)
        
        if rsi >= self.rsi_upper:
            return -1  # ä¹°å…¥å€ºåˆ¸/é™ä»“
        elif rsi <= self.rsi_lower:
            return 1   # ä¹°å…¥è‚¡ç¥¨
        else:
            return 0   # ä¸­æ€§

# 2. å¤šå› å­è¯„åˆ†ç³»ç»Ÿ
def calculate_comprehensive_score(stock_data):
    scores = {}
    
    # æŠ€æœ¯å› å­
    scores['rsi_score'] = calculate_rsi_factor(stock_data)
    scores['macd_score'] = calculate_macd_factor(stock_data)
    scores['volume_factor'] = calculate_volume_factor(stock_data)
    
    # åŸºæœ¬é¢å› å­
    scores['pe_score'] = calculate_pe_factor(stock_data)
    scores['pb_score'] = calculate_pb_factor(stock_data)
    
    # åŠ¨é‡å› å­
    scores['momentum_score'] = calculate_momentum_factor(stock_data)
    
    # å½’ä¸€åŒ–å¤„ç†
    normalized_scores = {}
    for factor, score in scores.items():
        normalized_scores[factor] = normalize_score(score)
    
    # ç»¼åˆè¯„åˆ†
    total_score = sum(normalized_scores.values()) / len(normalized_scores)
    
    return min(max(total_score, 0), 1)  # é™åˆ¶åœ¨[0,1]åŒºé—´

# 3. é£é™©æ§åˆ¶æ¨¡å—
def apply_risk_filters(stock_data, score):
    # è¡Œä¸šé›†ä¸­åº¦æ£€æŸ¥
    if check_industry_concentration_risk(stock_data):
        score *= 0.8  # é™ä½è¯„åˆ†
    
    # æµåŠ¨æ€§é£é™©æ£€æŸ¥
    if not check_liquidity_risk(stock_data):
        return 0  # ç›´æ¥æ’é™¤
    
    # è´¢åŠ¡é£é™©æ£€æŸ¥
    if check_financial_risk(stock_data):
        score *= 0.9  # é™ä½è¯„åˆ†
    
    return score
```

### ğŸš€ ä¹°å…¥ä¿¡å·ç”Ÿæˆ
åŸºäº3å› å­å¢å¼ºæ¨¡å‹ï¼Œæ»¡è¶³ä»¥ä¸‹**æ‰€æœ‰æ¡ä»¶**æ—¶äº§ç”Ÿä¹°å…¥ä¿¡å·ï¼š

1. **æ‹©æ—¶ä¿¡å·**ï¼šRSIå¸‚åœºæ‹©æ—¶ä¸ºæ­£
2. **ç»¼åˆè¯„åˆ†**ï¼šå¤šå› å­ç»¼åˆè¯„åˆ†â‰¥0.6
3. **è°ƒä»“æ—¶æœº**ï¼šå‘¨åº¦è°ƒä»“æ—¥
4. **é£é™©æ§åˆ¶**ï¼šé€šè¿‡å„é¡¹é£é™©æ£€æŸ¥

```python
def generate_buy_signals(self, current_date):
    signals = []
    
    # 1. æ£€æŸ¥æ˜¯å¦ä¸ºè°ƒä»“æ—¥
    if not self._should_rebalance(current_date):
        return signals  # éè°ƒä»“æ—¥ä¸äº§ç”Ÿä¹°å…¥ä¿¡å·
    
    # 2. è·å–å¸‚åœºæ‹©æ—¶ä¿¡å·
    market_signal = self.get_market_timing_signal(current_date)
    if market_signal <= 0:
        return signals  # å¸‚åœºæ‹©æ—¶ä¸åˆ©ï¼Œä¸ä¹°å…¥
    
    # 3. å¯¹å€™é€‰è‚¡ç¥¨è¿›è¡Œè¯„åˆ†
    candidate_scores = []
    for stock_code in self.candidate_stocks:
        try:
            stock_data = self.get_stock_data(stock_code, current_date)
            score = self.calculate_comprehensive_score(stock_data)
            
            # åº”ç”¨é£é™©è¿‡æ»¤
            if self.pass_risk_filters(stock_code, stock_data):
                candidate_scores.append((stock_code, score))
        except Exception as e:
            continue
    
    # 4. æŒ‰è¯„åˆ†æ’åºå¹¶é€‰æ‹©å‰Nåª
    candidate_scores.sort(key=lambda x: x[1], reverse=True)
    
    # 5. ç”Ÿæˆä¹°å…¥ä¿¡å·
    for stock_code, score in candidate_scores[:self.max_positions]:
        if score >= self.min_total_score:  # 0.6
            # æ ¹æ®å¸‚åœºä¿¡å·è°ƒæ•´ä»“ä½
            position_ratio = self.stock_ratio_bullish if market_signal > 0 else self.stock_ratio_bearish
            
            signal = TradeSignal(
                symbol=stock_code,
                timestamp=current_date,
                signal_type='buy',
                price=self.get_current_price(stock_code),
                volume=self.calculate_position_size(stock_code, position_ratio),
                reason=f'3å› å­å¢å¼ºå°ç›˜ç­–ç•¥(å¾—åˆ†:{score:.3f}): æ‹©æ—¶ä¿¡å·x{position_ratio}'
            )
            signals.append(signal)
    
    return signals
```

### ğŸ“‰ å–å‡ºä¿¡å·ç”Ÿæˆ
åˆ†ä¸ºä¸¤ç±»å–å‡ºä¿¡å·ï¼š**è°ƒä»“æ—¥å–å‡º**å’Œ**ç´§æ€¥æ­¢æŸå–å‡º**

#### è°ƒä»“æ—¥å–å‡ºæ¡ä»¶ï¼ˆä»»ä¸€æ»¡è¶³ï¼‰ï¼š
1. **è¯„åˆ†ä¸‹é™**ï¼šç»¼åˆè¯„åˆ†è·Œç ´é˜ˆå€¼
2. **æ‹©æ—¶è½¬å‘**ï¼šå¸‚åœºæ‹©æ—¶ä¿¡å·è½¬ä¸ºç†Šå¸‚
3. **æ’åä¸‹é™**ï¼šä¸å†ä½äºå‰Nåªè‚¡ç¥¨

#### ç´§æ€¥æ­¢æŸæ¡ä»¶ï¼ˆä»»ä¸€æ»¡è¶³ï¼‰ï¼š
1. **æ­¢æŸä¿æŠ¤**ï¼šè·Œç ´æ­¢æŸä½(-6%)
2. **æŠ€æœ¯å¼‚å¸¸**ï¼šRSIæç«¯å€¼æˆ–æ¢æ‰‹ç‡å¼‚å¸¸
3. **æ­¢ç›ˆä¿æŠ¤**ï¼šè¾¾åˆ°æ­¢ç›ˆä½(+15%)åå›æ’¤

```python
def generate_sell_signals(self, current_date):
    signals = []
    
    # 1. æ£€æŸ¥è°ƒä»“æ—¥å–å‡º
    if self._should_rebalance(current_date):
        # é‡æ–°è¯„åˆ†ï¼Œå–å‡ºæ’åé åçš„è‚¡ç¥¨
        signals.extend(self._generate_rebalance_sell_signals(current_date))
    
    # 2. æ£€æŸ¥ç´§æ€¥æ­¢æŸï¼ˆæ¯æ—¥æ£€æŸ¥ï¼‰
    signals.extend(self._generate_emergency_sell_signals(current_date))
    
    return signals

def _generate_emergency_sell_signals(self, current_date):
    signals = []
    
    for stock_code in self.positions.keys():
        if self.get_current_position(stock_code) <= 0:
            continue
            
        try:
            stock_data = self.get_stock_data(stock_code, current_date)
            emergency_signal = self._check_emergency_sell(stock_code, stock_data, current_date)
            
            if emergency_signal:
                signals.append(emergency_signal)
        except Exception as e:
            continue
    
    return signals

def _check_emergency_sell(self, stock_code, stock_data, current_date):
    current_price = stock_data['close']
    
    # 1. æ­¢æŸæ£€æŸ¥
    if self.check_stop_loss(stock_code, current_price):
        return self.create_sell_signal(stock_code, current_price, "æ­¢æŸä¿æŠ¤")
    
    # 2. æ­¢ç›ˆæ£€æŸ¥
    if self.check_take_profit(stock_code, current_price):
        return self.create_sell_signal(stock_code, current_price, "æ­¢ç›ˆä¿æŠ¤")
    
    # 3. æŠ€æœ¯å¼‚å¸¸æ£€æŸ¥
    rsi = stock_data.get('rsi_6', 50)
    if rsi > 90:
        return self.create_sell_signal(stock_code, current_price, f"ç´§æ€¥æ­¢æŸ: RSIæç«¯å€¼({rsi:.1f})")
    
    # 4. æ¢æ‰‹ç‡å¼‚å¸¸æ£€æŸ¥
    turnover = stock_data.get('turnover_rate', 0)
    if turnover > 20:  # æ¢æ‰‹ç‡è¶…è¿‡20%
        return self.create_sell_signal(stock_code, current_price, f"ç´§æ€¥æ­¢æŸ: æ¢æ‰‹ç‡å¼‚å¸¸({turnover:.2f}%)")
    
    return None
```

## é£é™©ç®¡ç†

### ğŸ’° èµ„é‡‘ç®¡ç†ï¼ˆ3å› å­å¢å¼ºé…ç½®ï¼‰
- **åˆå§‹èµ„é‡‘**ï¼š100ä¸‡å…ƒ
- **å•è‚¡é™é¢**ï¼šæœ€å¤§4ä¸‡å…ƒï¼ˆ4%ä»“ä½ï¼‰
- **å•è‚¡æœ€å¤§æƒé‡**ï¼š8%ï¼ˆé£é™©æ§åˆ¶ï¼‰
- **æ€»æŒä»“æ•°**ï¼š10-25åªè‚¡ç¥¨ï¼ˆé«˜åº¦åˆ†æ•£ï¼‰
- **è°ƒä»“é¢‘ç‡**ï¼šæ¯5ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦æ¯å‘¨ï¼‰
- **æ‹©æ—¶ä»“ä½**ï¼šç‰›å¸‚80%ï¼Œç†Šå¸‚20%è‚¡ç¥¨é…ç½®

### ğŸ›¡ï¸ é£é™©æ§åˆ¶ï¼ˆä¸‰é‡ä¿æŠ¤ï¼‰
- **æ­¢æŸæœºåˆ¶**ï¼šå•è‚¡-6%æ­¢æŸï¼Œ+15%æ­¢ç›ˆ
- **è¡Œä¸šåˆ†æ•£**ï¼šå•è¡Œä¸šæœ€å¤§æƒé‡30%
- **ä»“ä½æ§åˆ¶**ï¼šå•è‚¡æœ€å¤§4%ï¼Œé¿å…è¿‡åº¦é›†ä¸­
- **ç´§æ€¥æ­¢æŸ**ï¼šRSI>90æˆ–æ¢æ‰‹ç‡>20%æ—¶ç´§æ€¥å–å‡º
- **å¸‚åœºæ‹©æ—¶**ï¼šRSI(8æ—¥)åˆ¤æ–­å¸‚åœºç¯å¢ƒï¼ŒåŠ¨æ€è°ƒæ•´ä»“ä½
- **è´¨é‡ç­›é€‰**ï¼šå¸‚å€¼åŒºé—´100äº¿-1000äº¿ï¼Œé¿å…å¾®ç›˜è‚¡é£é™©

### â° æ—¶é—´ç®¡ç†ï¼ˆå‘¨åº¦è°ƒä»“ï¼‰
- **è°ƒä»“é¢‘ç‡**ï¼šæ¯5ä¸ªäº¤æ˜“æ—¥è°ƒä»“ä¸€æ¬¡
- **è°ƒä»“åˆ¤æ–­**ï¼š`_should_rebalance()`æ–¹æ³•æ§åˆ¶
- **éè°ƒä»“æ—¥**ï¼šä»…æ‰§è¡Œç´§æ€¥æ­¢æŸï¼Œä¸äº§ç”Ÿä¹°å…¥ä¿¡å·
- **æŒä»“å‘¨æœŸ**ï¼šå¹³å‡æŒä»“1-2ä¸ªæœˆ
- **æˆæœ¬æ§åˆ¶**ï¼šé™ä½äº¤æ˜“é¢‘ç‡ï¼Œå‡å°‘äº¤æ˜“æˆæœ¬

## å®ç°æ¶æ„

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„
```
å°å¸‚å€¼åŠ¨é‡ç­–ç•¥
â”œâ”€â”€ æ•°æ®å±‚
â”‚   â”œâ”€â”€ TuShareæ•°æ®æ¥å£
â”‚   â”œâ”€â”€ MongoDBæ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ å› å­æ•°æ®è®¡ç®—
â”œâ”€â”€ ç­–ç•¥å±‚
â”‚   â”œâ”€â”€ å¤šå› å­è¯„åˆ†æ¨¡å—
â”‚   â”œâ”€â”€ ä¿¡å·ç”Ÿæˆæ¨¡å—
â”‚   â””â”€â”€ é£é™©æ§åˆ¶æ¨¡å—
â”œâ”€â”€ å›æµ‹å±‚
â”‚   â”œâ”€â”€ å†å²æ•°æ®å›æµ‹
â”‚   â”œâ”€â”€ ç»©æ•ˆæŒ‡æ ‡è®¡ç®—
â”‚   â””â”€â”€ åŸºå‡†å¯¹æ¯”åˆ†æ
â””â”€â”€ å±•ç¤ºå±‚
    â”œâ”€â”€ ç­–ç•¥æŠ¥å‘Šç”Ÿæˆ
    â”œâ”€â”€ å› å­åˆ†æå›¾è¡¨
    â””â”€â”€ æŒä»“ç›‘æ§é¢æ¿
```

### ğŸ“ æ–‡ä»¶ç»“æ„
```
quantitative/strategies/small_cap_momentum_strategy.py     # ç­–ç•¥ä¸»æ–‡ä»¶
quantitative/test_small_cap_only.py                      # æµ‹è¯•æ–‡ä»¶
quantitative/core/dynamic_stock_pool_manager.py          # åŠ¨æ€é€‰è‚¡ç®¡ç†
quantitative/docs/å°å¸‚å€¼åŠ¨é‡ç­–ç•¥.md                       # ç­–ç•¥æ–‡æ¡£
```

## å†å²è¡¨ç°

### ğŸ“Š é¢„æœŸè¡¨ç°ï¼ˆåŸºäº3å› å­å¢å¼ºè®¾è®¡ï¼‰

#### ç›®æ ‡è¡¨ç°æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡èŒƒå›´ | å¤‡æ³¨ |
|------|----------|------|
| å¹´åŒ–æ”¶ç›Šç‡ | 15-25% | åŸºäºå°å¸‚å€¼æˆé•¿è‚¡ç‰¹æ€§ |
| å¤æ™®æ¯”ç‡ | 1.0-1.5 | é£é™©è°ƒæ•´åæ”¶ç›Š |
| æœ€å¤§å›æ’¤ | 18-30% | å°å¸‚å€¼è‚¡ç¥¨æ³¢åŠ¨æ€§ |
| èƒœç‡ | 60-70% | å¤šå› å­ç­›é€‰æå‡èƒœç‡ |
| è°ƒä»“æ¬¡æ•° | 20-30æ¬¡/å¹´ | æ¯å‘¨è°ƒä»“ |
| æŒä»“è‚¡æ•° | 10-25åª | åˆ†æ•£åŒ–é…ç½® |

#### ä¸åŸºå‡†å¯¹æ¯”é¢„æœŸ
- **vs æ²ªæ·±300**: é¢„æœŸè¶…é¢æ”¶ç›Š10-20%
- **vs ä¸­è¯500**: é¢„æœŸè¶…é¢æ”¶ç›Š5-15%
- **vs ä¸­è¯1000**: é¢„æœŸè¶…é¢æ”¶ç›Š3-8%
- **vs åˆ›ä¸šæ¿æŒ‡**: é¢„æœŸè¶…é¢æ”¶ç›Š8-18%

### ğŸ† æ ¸å¿ƒä¼˜åŠ¿ï¼ˆ3å› å­å¢å¼ºç‰ˆï¼‰
1. **å…¨é¢é£æ§**ï¼šä¸‰é‡ä¿æŠ¤æœºåˆ¶ï¼Œè¡Œä¸šåˆ†æ•£ï¼ŒåŠ¨æ€æ­¢æŸ
2. **æ‹©æ—¶ä¼˜åŒ–**ï¼šRSIå¸‚åœºæ‹©æ—¶ï¼Œç‰›ç†Šå¸‚ä»“ä½åŠ¨æ€è°ƒæ•´
3. **æˆæœ¬æ§åˆ¶**ï¼šå‘¨åº¦è°ƒä»“ï¼Œé™ä½äº¤æ˜“æˆæœ¬å’Œæ»‘ç‚¹å½±å“
4. **å¤šå› å­é€‰è‚¡**ï¼šç»¼åˆæŠ€æœ¯ã€åŸºæœ¬é¢ã€åŠ¨é‡å¤šç»´åº¦è¯„åˆ†
5. **å°ç›˜æˆé•¿**ï¼šä¸“æ³¨å°å¸‚å€¼è‚¡ç¥¨ï¼ŒæŒ–æ˜æˆé•¿æ½œåŠ›
6. **ç³»ç»Ÿæ€§å¼º**ï¼šè§„åˆ™åŒ–äº¤æ˜“ï¼Œå‡å°‘ä¸»è§‚åˆ¤æ–­è¯¯å·®

## æŠ€æœ¯å®ç°

### ğŸ”§ æ ¸å¿ƒç±»ç»“æ„ï¼ˆ3å› å­å¢å¼ºç‰ˆï¼‰
```python
class SmallCapMomentumStrategy(BaseStrategy):
    """å°å¸‚å€¼åŠ¨é‡ç­–ç•¥ - åŸºäº3å› å­ç­–ç•¥æ€æƒ³ä¼˜åŒ–"""
    
    def __init__(self, config: SmallCapMomentumConfig):
        super().__init__(config)
        
        # 3å› å­å¢å¼ºå‚æ•°
        self.position_size = 0.04           # å•è‚¡æœ€å¤§ä»“ä½4%
        self.max_single_stock = 0.08        # å•è‚¡æœ€å¤§æƒé‡8%
        self.stop_loss = 0.06               # æ­¢æŸ6%
        self.take_profit = 0.15             # æ­¢ç›ˆ15%
        self.rebalance_frequency = 5        # æ¯5ä¸ªäº¤æ˜“æ—¥è°ƒä»“
        
        # æ‹©æ—¶å‚æ•°
        self.market_timing_enabled = True   # å¯ç”¨å¸‚åœºæ‹©æ—¶
        self.rsi_period = 8                 # RSIå‘¨æœŸ
        self.stock_ratio_bullish = 0.8      # ç‰›å¸‚è‚¡ç¥¨æ¯”ä¾‹
        self.stock_ratio_bearish = 0.2      # ç†Šå¸‚è‚¡ç¥¨æ¯”ä¾‹
        
        # é£é™©æ§åˆ¶å‚æ•°
        self.max_industry_weight = 0.3      # å•è¡Œä¸šæœ€å¤§æƒé‡30%
        self.min_total_score = 0.6          # æœ€ä½æ€»åˆ†è¦æ±‚
        
    def generate_signals(self, current_date) -> List[TradeSignal]:
        """ç”Ÿæˆäº¤æ˜“ä¿¡å·ï¼ˆæ”¯æŒç»„åˆç­–ç•¥ï¼‰"""
        if hasattr(self, 'stocks_data') and self.stocks_data:
            return self._generate_portfolio_signals(current_date)
        else:
            return self._generate_single_stock_signals(current_date)
    
    def _should_rebalance(self, current_date: datetime) -> bool:
        """æ£€æŸ¥æ˜¯å¦åº”è¯¥è°ƒä»“"""
        if not hasattr(self, 'last_rebalance_date') or self.last_rebalance_date is None:
            return True
        
        # è®¡ç®—è·ç¦»ä¸Šæ¬¡è°ƒä»“çš„å·¥ä½œæ—¥å¤©æ•°
        days_diff = (current_date - self.last_rebalance_date).days
        return days_diff >= self.rebalance_frequency
    
    def get_market_timing_signal(self, current_date: datetime) -> int:
        """è·å–å¸‚åœºæ‹©æ—¶ä¿¡å·"""
        # åŸºäºRSIçš„å¸‚åœºæ‹©æ—¶åˆ¤æ–­
        # è¿”å›å€¼ï¼š1=ä¹°å…¥è‚¡ç¥¨ï¼Œ-1=ä¹°å…¥å€ºåˆ¸/é™ä»“ï¼Œ0=ä¸­æ€§
        pass
```

### ğŸ“Š æ•°æ®ä¾èµ–
```python
# ä¸»è¦æ•°æ®è¡¨
- stock_factor_pro: æŠ€æœ¯å› å­æ•°æ®
  - close, high, low, open: ä»·æ ¼æ•°æ®
  - vol, amount: æˆäº¤é‡æ•°æ®
  - pe_ttm, pb, ps_ttm: ä¼°å€¼æ•°æ®
  - rsi_*, macd_*, boll_*: æŠ€æœ¯æŒ‡æ ‡
  
- fina_indicator: è´¢åŠ¡æŒ‡æ ‡æ•°æ®
  - roe, roa: ç›ˆåˆ©èƒ½åŠ›æŒ‡æ ‡
  - debt_to_assets: è´Ÿå€ºç‡
  - revenue_yoy: è¥æ”¶å¢é•¿ç‡
  
- index_weight: æŒ‡æ•°æˆåˆ†è‚¡
  - index_code: '000852.SH' (ä¸­è¯1000)
  - con_code: æˆåˆ†è‚¡ä»£ç 
```

## ä½¿ç”¨æŒ‡å—

### ğŸš€ å¿«é€Ÿå¼€å§‹
```bash
# 1. è¿›å…¥ç­–ç•¥ç›®å½•
cd quantitative

# 2. è¿è¡Œå®Œæ•´å›æµ‹
python test_small_cap_only.py

# 3. æŸ¥çœ‹ç»“æœ
# è¯¦ç»†ç»“æœä¿å­˜åœ¨ small_cap_backtest_results_*.json
```

### âš™ï¸ å‚æ•°é…ç½®ï¼ˆ3å› å­å¢å¼ºç‰ˆï¼‰
```python
strategy_config = SmallCapMomentumConfig(
    symbol=selected_stocks[0],
    start_date=start_date,
    end_date=end_date,
    initial_capital=1000000.0,      # 100ä¸‡èµ„é‡‘
    
    # 3å› å­ç­–ç•¥ä¼˜åŒ–å‚æ•°
    position_size=0.04,             # å•è‚¡æœ€å¤§ä»“ä½4%
    max_market_cap=1000000.0,       # æœ€å¤§å¸‚å€¼1000äº¿
    min_market_cap=100000.0,        # æœ€å°å¸‚å€¼100äº¿
    volume_ratio_min=0.8,           # é‡æ¯”æœ€ä½è¦æ±‚
    turnover_rate_min=1.0,          # æ¢æ‰‹ç‡æœ€ä½è¦æ±‚1%
    turnover_rate_max=12.0,         # æ¢æ‰‹ç‡ä¸Šé™12%
    min_total_score=0.6,            # æœ€ä½æ€»åˆ†è¦æ±‚
    strong_signal_score=0.8,        # å¼ºä¿¡å·åˆ†æ•°é˜ˆå€¼
    
    # æ‹©æ—¶å‚æ•°
    market_timing_enabled=True,     # å¯ç”¨å¸‚åœºæ‹©æ—¶
    rsi_period=8,                   # RSIå‘¨æœŸ
    rsi_upper=70,                   # RSIä¸Šé™
    rsi_lower=30,                   # RSIä¸‹é™
    stock_ratio_bullish=0.8,        # ç‰›å¸‚è‚¡ç¥¨æ¯”ä¾‹
    stock_ratio_bearish=0.2,        # ç†Šå¸‚è‚¡ç¥¨æ¯”ä¾‹
    
    # é£é™©æ§åˆ¶å‚æ•°
    max_industry_weight=0.3,        # å•è¡Œä¸šæœ€å¤§æƒé‡30%
    max_single_stock=0.08,          # å•è‚¡æœ€å¤§æƒé‡8%
    stop_loss=0.06,                 # æ­¢æŸ6%
    take_profit=0.15                # æ­¢ç›ˆ15%
)
```

### ğŸ“ˆ è‡ªå®šä¹‰ä¼˜åŒ–
- **è°ƒæ•´å› å­æƒé‡**ï¼šæ ¹æ®å¸‚åœºç¯å¢ƒä¼˜åŒ–å› å­é…ç½®
- **ä¿®æ”¹é€‰è‚¡æ•°é‡**ï¼šå¹³è¡¡åˆ†æ•£åº¦å’Œé€‰æ‹©æ€§
- **ä¼˜åŒ–æ­¢æŸç­–ç•¥**ï¼šæé«˜é£é™©æ§åˆ¶æ•ˆæœ
- **å¢åŠ è¡Œä¸šè¿‡æ»¤**ï¼šæ§åˆ¶è¡Œä¸šé›†ä¸­åº¦é£é™©

## ç­–ç•¥ä¼˜åŒ–å»ºè®®

### ğŸ¯ å‚æ•°ä¼˜åŒ–æ–¹å‘
1. **å› å­æƒé‡**ï¼šæ ¹æ®å¸‚åœºç¯å¢ƒåŠ¨æ€è°ƒæ•´
2. **æŒä»“æ•°é‡**ï¼šå¯è°ƒæ•´5-15åªè‚¡ç¥¨
3. **è°ƒä»“é¢‘ç‡**ï¼šå¯å°è¯•åŒå‘¨æˆ–æœˆåº¦è°ƒä»“
4. **æ­¢æŸç­–ç•¥**ï¼šå¯å¼•å…¥åŠ¨æ€æ­¢æŸæœºåˆ¶

### ğŸ“Š å¢å¼ºåŠŸèƒ½
1. **è¡Œä¸šè½®åŠ¨**ï¼šç»“åˆè¡Œä¸šæ™¯æ°”åº¦åˆ†æ
2. **å®è§‚æ‹©æ—¶**ï¼šåŠ å…¥å®è§‚ç»æµæŒ‡æ ‡
3. **æƒ…ç»ªæŒ‡æ ‡**ï¼šç»“åˆå¸‚åœºæƒ…ç»ªæ•°æ®
4. **æœºå™¨å­¦ä¹ **ï¼šä½¿ç”¨MLä¼˜åŒ–å› å­æƒé‡

### ğŸ”„ å®ç›˜é€‚é…
1. **äº¤æ˜“æˆæœ¬**ï¼šè€ƒè™‘å®é™…æ‰‹ç»­è´¹å’Œå†²å‡»æˆæœ¬
2. **æµåŠ¨æ€§ç®¡ç†**ï¼šé¿å…æµåŠ¨æ€§ä¸è¶³çš„è‚¡ç¥¨
3. **é£é™©ç›‘æ§**ï¼šå®æ—¶ç›‘æ§ç»„åˆé£é™©æŒ‡æ ‡
4. **èµ„é‡‘ç®¡ç†**ï¼šåŠ¨æ€è°ƒæ•´ä»“ä½å¤§å°

## æ³¨æ„äº‹é¡¹

### âš ï¸ é£é™©æç¤º
1. **å°å¸‚å€¼é£é™©**ï¼šå°å¸‚å€¼è‚¡ç¥¨æ³¢åŠ¨è¾ƒå¤§
2. **æµåŠ¨æ€§é£é™©**ï¼šéƒ¨åˆ†è‚¡ç¥¨å¯èƒ½æµåŠ¨æ€§ä¸è¶³
3. **é›†ä¸­åº¦é£é™©**ï¼šé¿å…è¿‡åº¦é›†ä¸­äºæŸä¸ªè¡Œä¸š
4. **å¸‚åœºé£é™©**ï¼šç³»ç»Ÿæ€§é£é™©æ— æ³•å®Œå…¨è§„é¿

### ğŸ”§ æŠ€æœ¯è¦æ±‚
- Python 3.8+
- MongoDBæ•°æ®åº“
- TuShareæ•°æ®æº
- å……è¶³çš„è®¡ç®—èµ„æº

### ğŸ“ æŠ€æœ¯æ”¯æŒ
- ç­–ç•¥å®ç°ï¼šåŸºäºkk_stocké‡åŒ–å¹³å°
- æ•°æ®æ”¯æŒï¼šTuShareä¸“ä¸šç‰ˆ
- å›æµ‹å¼•æ“ï¼šè‡ªç ”å¢å¼ºå›æµ‹ç³»ç»Ÿ
- æŠ€æœ¯æ¶æ„ï¼šå¾®æœåŠ¡åŒ–è®¾è®¡

## ç‰ˆæœ¬å†å²

### v2.0.0 (2025-01-17) - 3å› å­å¢å¼ºç‰ˆ
- âœ… é›†æˆ3å› å­ç­–ç•¥æ€æƒ³ï¼ˆRSIæ‹©æ—¶+å¤šå› å­è¯„åˆ†+é£é™©æ§åˆ¶ï¼‰
- âœ… å®ç°å‘¨åº¦è°ƒä»“æœºåˆ¶ï¼Œé™ä½äº¤æ˜“æˆæœ¬
- âœ… å¢åŠ å¸‚åœºæ‹©æ—¶æ¨¡å—ï¼ŒåŠ¨æ€è°ƒæ•´ä»“ä½
- âœ… å®Œå–„é£é™©æ§åˆ¶ï¼šè¡Œä¸šåˆ†æ•£ã€ç´§æ€¥æ­¢æŸã€åŠ¨æ€æ­¢ç›ˆ
- âœ… ä¼˜åŒ–æŒä»“ç»“æ„ï¼šå•è‚¡4%ä»“ä½ï¼Œæœ€å¤§25åªè‚¡ç¥¨
- âœ… ä¿®å¤ç±»å‹é”™è¯¯ï¼Œç¡®ä¿ç­–ç•¥ç¨³å®šè¿è¡Œ

### æœªæ¥è§„åˆ’
- ğŸ”„ å®ç›˜äº¤æ˜“æ¥å£å¯¹æ¥
- ğŸ“Š å› å­æœ‰æ•ˆæ€§åˆ†æå·¥å…·
- ğŸ¤– æœºå™¨å­¦ä¹ å› å­ä¼˜åŒ–
- ğŸ“± ç§»åŠ¨ç«¯ç›‘æ§åº”ç”¨

---

**å¤ªä¸Šè€å›3å·ç­–ç•¥ï¼ˆå°å¸‚å€¼åŠ¨é‡3å› å­å¢å¼ºç‰ˆï¼‰** - æ‹©æ—¶+é€‰è‚¡+é£æ§ï¼Œä¸‰ä½ä¸€ä½“çš„ä¸“ä¸šé‡åŒ–è§£å†³æ–¹æ¡ˆï¼ ğŸ¯

> åŸºäºkk_stocké‡åŒ–å¹³å° | æ•°æ®æ¥æºï¼šTuShare | å›æµ‹å¼•æ“ï¼šè‡ªç ”å¢å¼ºç‰ˆ | è‚¡ç¥¨æ± ï¼šä¸­è¯1000æˆåˆ†è‚¡ | 3å› å­ç­–ç•¥æ€æƒ³ä¼˜åŒ–